# 2. 多文件编程与构建系统

这里我们只介绍常见的最小化工程项目开发方式 (个人推荐)
> 说到 构建工具其实我更加推荐 `zig` 来编译 c/cpp 项目，参见 https://www.bilibili.com/video/BV16P8JzjEMa

## 常见的工程项目文件组织方式
```
your-dev-project/
├── CMakeLists.txt                          # 如果选择了 meson 则是 meson.build
├── README.md                               # 项目的自我介绍文件
├── LICENSE                                 # 项目使用的开源协议
├── include/                                # 所有项目头文件
│   ├── Foo.hpp
│   └── Bar.hpp
├── src/
│   ├── Foo.cpp                             # 对 Foo.hpp 的实现
│   └── Bar.cpp                             # 对 Bar.hpp 的实现
├── main.cpp                                # 项目主入口 (当然也可以写到 src 中，你完全可以在构建文件中配置)
└── .gitignore                              # 项目 git 提交的忽略文件配置

```

## 对于 Cmake
我推荐这样写 CMakeLists.txt
```cmake
# 最低要求的 CMake 版本（选 3.16 或更高以使用现代特性）
cmake_minimum_required(VERSION 3.16)


# 定义项目名、版本和使用的语言
project(your_project VERSION 0.1 LANGUAGES CXX)


# -------------------------------------------------------------
# 说明：推荐使用 target_* 系列命令把配置局限在具体 target 上，
# 避免使用旧式的全局命令（如 include_directories 全局调用）
# -------------------------------------------------------------


# 直接列出源文件并创建可执行文件 target
add_executable(${PROJECT_NAME}
    src/Foo.cpp
    src/Bar.cpp
    main.cpp
)


# 为该 target 添加头文件搜索路径（仅对该 target 生效）
# PRIVATE 表示该 include 只对本 target 生效，不会传播给 link 的依赖
target_include_directories(${PROJECT_NAME}
    PRIVATE ${PROJECT_SOURCE_DIR}/include
)


# 指定 C++ 标准（使用 target_compile_features 更语义化）
# 这里使用 CMake 的 compile feature，要保证编译器支持 cxx_std_17
# 设置为 PRIVATE，因为这是该 target 的内部实现细节
target_compile_features(${PROJECT_NAME} PRIVATE cxx_std_17)


# 如果你需要添加编译选项（比如 -Wall），也可以只针对该 target：
# target_compile_options(${PROJECT_NAME} PRIVATE -Wall -Wextra -Wpedantic)


# 如果需要链接外部库（系统库或第三方库），使用 target_link_libraries
# 例如：
# find_package(SomeLib REQUIRED)
# target_link_libraries(${PROJECT_NAME} PRIVATE SomeLib::SomeLib)


# 可选：设置输出目录（不同平台上可能需要不同变量）
# set_target_properties(${PROJECT_NAME} PROPERTIES
#   RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
# )
```
编译命令
```bash
mkdir build && cd build
cmake ..
cmake --build . --config Release
```

更多 请查看 
[cmake 的开发文档-英文](https://cmake.org/cmake/help/latest/index.html) 
[cmake 的开发文档-中文](https://cmake.com.cn/cmake/help/latest/index.html) 

## 对于 Meson
我推荐这样写 meson.build
```meson
# project() 定义项目名、语言版本和默认选项
project('your_project', 'cpp',
    version: '0.1',
    default_options: ['cpp_std=c++17']
)


# include_directories 返回一个 include_directories 对象，供 executable 使用
inc = include_directories('include')


# 列出源文件
src = ['src/Foo.cpp', 'src/Bar.cpp', 'main.cpp']


# 创建可执行文件，传入 include_directories
exe = executable('your_project', src, include_directories: inc)


# 如果需要链接外部库，使用 dependency() 或者直接 link_with
# 例如：
# some_dep = dependency('opencv4', required: false)
# if some_dep.found()
# exe.link_with(some_dep)
# endif


# 测试/安装示例（可选）
# test('basic', executable('test_binary', ['tests/test_main.cpp'],
# include_directories: inc))
```

编译命令
```bash
meson setup build
meson compile -C build
meson test -C build
```
