# 3. 使用第三方库

在 **MSYS2**  你可以通过 pacman 安装官方提供的库，然后在 CMake 或 Meson 项目中使用。

---

## 🧩 1. 使用系统已安装的库（推荐）

MSYS2 提供了 `mingw-w64-ucrt-x86_64` 系列包，例如 `mingw-w64-ucrt-x86_64-opencv`、`mingw-w64-ucrt-x86_64-glfw` 等。

### ✅ 使用 CMake

```cmake
project(your_project
    VERSION 0.1.0  
    LANGUAGES C CXX  
)
# 找 系统 的 opencv 库
find_package(OpenCV REQUIRED)
# 找到 opencv 头文件
include_directories(${OpenCV_INCLUDE_DIRS})
# name of executable file and path of source file
# 直接列出源文件并创建可执行文件 target
add_executable(${PROJECT_NAME}
    src/Foo.cpp
    src/Bar.cpp
    main.cpp
)
# directory of opencv library
link_directories(${OpenCV_LIBRARY_DIRS})
# opencv libraries
target_link_libraries((${PROJECT_NAME} PRIVATE ${OpenCV_LIBS})
```

> 💡 小贴士：
> - 使用 MSYS2 安装库，例如：
> ```bash
> pacman -S mingw-w64-ucrt-x86_64-opencv
> ```
> - MSYS2 下的 MinGW64 环境编译时，CMake 会自动找到库路径和头文件。

### ✅ 使用 Meson

```meson
# project() 定义项目名、语言版本和默认选项
project('your_project', 'cpp',
    version: '0.1',
    default_options: ['cpp_std=c++17']
)


# include_directories 返回一个 include_directories 对象，供 executable 使用
inc = include_directories('include')


# 列出源文件
src = ['src/Foo.cpp', 'src/Bar.cpp', 'main.cpp']

opencv = dependency('opencv4', required: true)
exe = executable('your_project', 
    src, 
    include_directories: inc, 
    dependencies: [
        # 在这里添加依赖
        opencv 
    ]
)
```

Meson 会通过 MSYS2 提供的 pkg-config 自动查找库。

---

## 📦 2. 手动引入已编译的库

如果某些库在 MSYS2 中没有包，或者需要固定版本，可以手动编译库，然后放入项目中，例如：

```
your-dev-project/
├── external/
│   └── mylib/
│       ├── include/
│       │   └── mylib.hpp
│       └── lib/
│           └── libmylib.a       # 静态库
├── src/
│   └── main.cpp
└── CMakeLists.txt
```

### ✅ CMake 用法

```cmake
target_include_directories(${PROJECT_NAME} PRIVATE
    ${PROJECT_SOURCE_DIR}/external/mylib/include
)

target_link_libraries(${PROJECT_NAME} PRIVATE
    ${PROJECT_SOURCE_DIR}/external/mylib/lib/libmylib.a
)
```

### ✅ Meson 用法

```meson
mylib_inc = include_directories('external/mylib/include')
mylib_lib = files('external/mylib/lib/libmylib.a')

exe = executable('your_project', src,
    include_directories: [inc, mylib_inc],
    link_with: mylib_lib
)
```

> 🧰 小贴士：
> - 将库版本和来源记录在 `external/mylib/README.md`；
> - 如果是动态库（`.dll`），运行时需要把路径加入系统 `PATH`。

---

## ⚙️ 3. 将源码直接加入项目（不推荐）

如果库非常小、只需部分功能且无复杂依赖，可以把源文件直接放进项目：

```
your-dev-project/
├── include/
│   ├── Foo.hpp
│   └── external_math.hpp
├── src/
│   ├── Foo.cpp
│   └── external_math.cpp
└── main.cpp
```

然后在 CMake 中直接编译：

```cmake
add_executable(${PROJECT_NAME}
    src/Foo.cpp
    src/external_math.cpp
    main.cpp
)
target_include_directories(${PROJECT_NAME} PRIVATE include)
```

> ⚠️ 注意：
> - 不适合库依赖复杂或后续需要升级的情况；
> - 仅用于非常小的库或单文件功能。

---

## 📘 总结

| 方式 | 优点 | 缺点 | 适用场景 |
|------|------|------|-----------|
| 系统查找 | 简单、干净、自动查找 | 依赖 MSYS2 提供包 | 官方支持的库 |
| 手动引入编译库 | 固定版本、跨平台一致 | 需要自己管理库文件 | 闭源 SDK 或 MSYS2 无包 |
| 直接加入源码 | 无需额外依赖 | 难维护、易出错 | 小型功能库 |

> ✅ 推荐顺序：MSYS2 系统库 > 手动 external > 源码内置
